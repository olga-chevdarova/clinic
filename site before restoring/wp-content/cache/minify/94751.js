(function(d,m,h,n){function k(a,b){this.element=a;this.$element=d(a);this.settings=d.extend({},l,b);this._defaults=l;this._name="eaBootstrap";this.init()}var l={main_selector:"#ea-bootstrap-main",main_template:null,overview_selector:"#ea-appointments-overview",overview_template:null,store:{},ajaxCount:0};d.extend(k.prototype,{init:function(){var a=this;a.settings.main_template=_.template(d(a.settings.main_selector).html());a.settings.overview_template=_.template(d(a.settings.overview_selector).html());
this.$element.html(a.settings.main_template({settings:ea_settings}));if(this.settingsOk()){this.$element.find("form").validate();this.$element.find("select").not(".custom-field").change(jQuery.proxy(this.getNextOptions,this));jQuery.datepicker.setDefaults(d.datepicker.regional[ea_settings.datepicker]);var b=ea_settings.start_of_week;this.$element.find(".date").datepicker({onSelect:jQuery.proxy(a.dateChange,a),dateFormat:"yy-mm-dd",minDate:0,firstDay:b,defaultDate:ea_settings.default_date,onChangeMonthYear:function(c,
b,d){a.selectChange(b,c)},beforeShowDay:function(a){var b=a.getMonth()+1,c=a.getDate();10>b&&(b="0"+b);10>c&&(c="0"+c);return[!0,a.getFullYear()+"-"+b+"-"+c,""]}});this.hideDefault();this.$element.find(".ea-bootstrap").on("click",".time-value",function(b){b.preventDefault();d(this).parent().children().removeClass("selected-time");d(this).addClass("selected-time");if("1"===ea_settings["pre.reservation"])a.appSelected.apply(a);else{b={};b.location=a.$element.find('[name="location"] > option:selected').text();
b.service=a.$element.find('[name="service"] > option:selected').text();b.worker=a.$element.find('[name="worker"] > option:selected').text();b.date=a.$element.find(".date").datepicker().val();b.time=a.$element.find(".selected-time").data("val");b.price=a.$element.find('[name="service"] > option:selected').data("price");var c=ea_settings.date_format+" "+ea_settings.time_format;b.date_time=moment(b.date+" "+b.time,ea_settings.defult_detafime_format).format(c);c="";c=a.settings.overview_template({data:b,
settings:ea_settings});a.$element.find("#booking-overview").html(c);a.$element.find("#ea-total-amount").on("checkout:done",function(b,c){var d=a.$element.find("#paypal_transaction_id");0==d.length&&(d=jQuery('<input id="paypal_transaction_id" class="custom-field" name="paypal_transaction_id" type="hidden"/>'),a.$element.find(".final").append(d));d.val(c);a.singleConformation(b)});a.$element.find(".final").removeClass("disabled");a.$element.find(".final").find("select,input").first().focus();a.scrollToElement(a.$element.find(".final"))}a.loadPreviousFormData(a.$element.find("form"))});
this.blurNextSteps(this.$element.find(".step:visible:first"),!0);if("1"===ea_settings["pre.reservation"])this.$element.find(".ea-submit").on("click",jQuery.proxy(a.finalComformation,a));else this.$element.find(".ea-submit").on("click",jQuery.proxy(a.singleConformation,a));this.$element.find(".ea-cancel").on("click",jQuery.proxy(a.cancelApp,a))}},settingsOk:function(){var a=this.$element.find("select").not(".custom-field"),b=d('<div style="border: 1px solid gray; padding: 20px;">'),c=!0;a.each(function(a,
f){var g=d(f),e=g.children("option");1===e.length&&""==e.attr("value")&&(d(h.createElement("p")).html("You need to define at least one <strong>"+g.attr("name")+"</strong>.").appendTo(b),c=!1)});c||(b.prepend("<h4>East Appointments - Settings validation:</h4>"),b.append("<p>There should be at least one Connection.</p>"),this.$element.html(b));return c},hideDefault:function(){this.$element.find(".step").each(function(a,b){var c=d(b).find("select").not(".custom-field");1>c.length||(c=c.children("option"),
1===c.length&&""!==c.value&&d(b).hide())})},getPrevousOptions:function(a){var b={};a.parents(".step").prevAll(".step").each(function(a,e){var c=d(e).find("select,input").first();b[d(c).data("c")]=c.val()});return b},getNextOptions:function(a){a=d(a.target);var b=a.closest(".step");this.blurNextSteps(b);if(""!==a.val()){var c={};c[a.data("c")]=a.val();b.prevAll(".step").each(function(a,b){var g=d(b).find("select,input").first();c[d(g).data("c")]=g.val()});this.$element.find(".step:hidden").each(function(a,
b){var g=d(b).find("select,input").first();c[d(g).data("c")]=g.val()});a=b.nextAll(".step:visible:first");next=d(a).find("select,input");0===next.length?this.blurNextSteps(a):(c.next=next.data("c"),this.callServer(c,next))}},callServer:function(a,b){var c=this;a.action="ea_next_step";a.check=ea_settings.check;this.placeLoader(b.parent());d.get(ea_ajaxurl,a,function(a){b.empty();b.append('<option value="">-</option>');d.each(a,function(a,c){var f=d('<option value="'+c.id+'">'+c.name+"</option>");"price"in
c&&"1"!==ea_settings["price.hide"]&&("1"==ea_settings["currency.before"]?f.text(c.name+" - "+b.data("currency")+c.price):f.text(c.name+" - "+c.price+b.data("currency")),f.data("price",c.price));b.append(f)});b.closest(".step").removeClass("disabled");c.removeLoader();c.scrollToElement(b.parent())},"json").error(function(a,b){403===a.status&&alert(ea_settings["trans.nonce-expired"]);500===a.status&&alert(ea_settings["trans.internal-error"]);c.removeLoader()})},placeLoader:function(a){if(1===++this.settings.ajaxCount){var b=
a.width(),c=a.height();d("#ea-loader").prependTo(a);d("#ea-loader").css({width:b,height:c});d("#ea-loader").show()}},removeLoader:function(){1<--this.settings.ajaxCount||(this.settings.ajaxCount=0,d("#ea-loader").hide())},getCurrentStatus:function(){d(this.element).find("select").not(".custom-field")},blurNextSteps:function(a,b){b=b||!1;a.removeClass("disabled");var c=a.nextAll(".step:visible"),e=a.parent().nextAll(".step:visible");d.merge(c,e);c.each(function(a,b){d(b).addClass("disabled")});a.hasClass("calendar")&&
(c=this.$element.find(".date"),this.selectChange(),b||this.scrollToElement(c))},dateChange:function(a,b){var c=this,e;var f=d(b.dpDiv).parents(".date");f.parent().next().addClass("disabled");var g=this.getPrevousOptions(f);g.action="ea_date_selected";g.date=a;g.check=ea_settings.check;this.placeLoader(f);d.get(ea_ajaxurl,g,function(a){e=d(h.createElement("div")).addClass("time well well-lg");a.sort(function(a,b){var c=a.value,d=b.value;return c==d?0:c>d?1:-1});d.each(a,function(a,b){if(0<b.count){var c=
"am-pm"==ea_settings.time_format?" am-pm":"";e.append('<a href="#" class="time-value'+c+'" data-val="'+b.value+'">'+b.show+"</a>")}else c="am-pm"==ea_settings.time_format?" am-pm":"",e.append('<a class="time-disabled'+c+'">'+b.show+"</a>")});0===a.length&&e.html('<p class="time-message">'+ea_settings["trans.please-select-new-date"]+"</p>");a=d(h.createElement("tr")).addClass("time-row").append('<td colspan="7" />');a.find("td").append(e);d(b.dpDiv).find(".ui-datepicker-current-day").closest("tr").after(a);
e.parent().removeClass("disabled");e.find(".time-value:first").focus()},"json").error(function(a,b){403===a.status&&alert(ea_settings["trans.nonce-expired"]);500===a.status&&alert(ea_settings["trans.internal-error"]);c.removeLoader()}).always(function(){c.refreshData(c.settings.store);c.removeLoader()})},selectChange:function(a,b){var c=this;c.placeLoader(c.$element.find(".calendar"));var e=!1;if("undefined"===typeof a||"undefined"===typeof b){var f=this.$element.find('[data-handler="selectDay"]:first');
a=parseInt(f.data("month"))+1;b=f.data("year")}e=!0;this.checkStatus()&&(f=this.$element.find("select").not(".custom-field").serializeArray(),f.push({name:"action",value:"ea_month_status"}),f.push({name:"month",value:a}),f.push({name:"year",value:b}),f.push({name:"check",value:ea_settings.check}),d.get(ea_ajaxurl,f,function(a){c.settings.store=a;c.refreshData(a);e&&(a=c.$element.find(".ui-datepicker-current-day"),a.hasClass("free")?a.click():c.$element.find(".time-row").remove())},"json").error(function(a,
b){403===a.status&&alert(ea_settings["trans.nonce-expired"]);500===a.status&&alert(ea_settings["trans.internal-error"]);plugin.removeLoader()}))},refreshData:function(a){var b=this.$element.find(".date");d.each(a,function(a,d){var c=b.find("."+a);c.removeClass("free");c.removeClass("busy");c.removeClass("no-slots");c.addClass(d)});this.removeLoader()},checkStatus:function(){var a=!0;this.$element.find("select").not(".custom-field").each(function(b,c){a=a&&""!==d(c).val()});return a},appSelected:function(a){var b=
this;this.placeLoader(this.$element.find(".selected-time"));a={location:this.$element.find('[name="location"]').val(),service:this.$element.find('[name="service"]').val(),worker:this.$element.find('[name="worker"]').val(),date:this.$element.find(".date").datepicker().val(),start:this.$element.find(".selected-time").data("val"),check:ea_settings.check,action:"ea_res_appointment"};var c={};c.location=this.$element.find('[name="location"] > option:selected').text();c.service=this.$element.find('[name="service"] > option:selected').text();
c.worker=this.$element.find('[name="worker"] > option:selected').text();c.date=this.$element.find(".date").datepicker().val();c.time=this.$element.find(".selected-time").data("val");c.price=this.$element.find('[name="service"] > option:selected').data("price");var e=ea_settings.date_format+" "+ea_settings.time_format;c.date_time=moment(c.date+" "+c.time,ea_settings.defult_detafime_format).format(e);d.get(ea_ajaxurl,a,function(a){b.res_app=a.id;b.$element.find(".step").addClass("disabled");b.$element.find(".final").removeClass("disabled");
b.scrollToElement(b.$element.find(".final"));a="";a=b.settings.overview_template({data:c,settings:ea_settings});b.$element.find("#booking-overview").html(a);b.$element.find("#ea-total-amount").on("checkout:done",function(a,c){var d=b.$element.find("#paypal_transaction_id");0==d.length&&(d=jQuery('<input id="paypal_transaction_id" class="custom-field" name="paypal_transaction_id" type="hidden"/>'),b.$element.find(".final").append(d));d.val(c);b.finalComformation(a)})},"json").error(function(a,c){403===
a.status&&alert(ea_settings["trans.nonce-expired"]);500===a.status&&alert(ea_settings["trans.internal-error"]);b.removeLoader()}).always(d.proxy(function(){b.removeLoader()},b))},loadPreviousFormData:function(a){if("undefined"!==typeof localStorage){var b=JSON.parse(localStorage.getItem("ea-form-options"));null!=b&&Object.keys(b).forEach(function(c){a.find('[name="'+c+'"]').val(b[c])})}},storeFormData:function(a){"undefined"!==typeof localStorage&&localStorage.setItem("ea-form-options",JSON.stringify(a))},
finalComformation:function(a){a.preventDefault();var b=this;if(this.$element.find("form").valid()){this.$element.find(".ea-submit").prop("disabled",!0);var c={id:this.res_app,check:ea_settings.check};this.$element.find(".custom-field").each(function(a,b){var e=d(b).attr("name");c[e]=d(b).val()});c.action="ea_final_appointment";d.get(ea_ajaxurl,c,function(a){b.storeFormData(c);b.$element.find(".ea-submit").hide();b.$element.find(".ea-cancel").hide();b.$element.find("#paypal-button").hide();b.$element.find(".final").append("<h3>"+
ea_settings["trans.done_message"]+"</h3>");b.$element.find("form").find("input,select,textarea").prop("disabled",!0);b.triggerEvent();""!==ea_settings["submit.redirect"]&&setTimeout(function(){m.location.href=ea_settings["submit.redirect"]},2E3)},"json").fail(d.proxy(function(){this.$element.find(".ea-submit").prop("disabled",!1)},b))}},singleConformation:function(a){a.preventDefault();var b=this;if(this.$element.find("form").valid()){this.$element.find(".ea-submit").prop("disabled",!0);var c={location:this.$element.find('[name="location"]').val(),
service:this.$element.find('[name="service"]').val(),worker:this.$element.find('[name="worker"]').val(),date:this.$element.find(".date").datepicker().val(),start:this.$element.find(".selected-time").data("val"),check:ea_settings.check,action:"ea_res_appointment"};d.get(ea_ajaxurl,c,function(c){b.res_app=c.id;b.finalComformation(a)},"json").fail(d.proxy(function(a){alert(a.responseJSON.message);this.$element.find(".ea-submit").prop("disabled",!1)},b)).always(d.proxy(function(){b.removeLoader()},b))}},
triggerEvent:function(){var a=h.createEvent("Event");a.initEvent("easyappnewappointment",!0,!0);h.dispatchEvent(a)},cancelApp:function(a){a.preventDefault();var b=this;if("0"===ea_settings["pre.reservation"])return b.chooseStep(),b.res_app=null,this.$element.find(".step:not(.final)").prevAll(".step").removeClass("disabled"),!1;this.$element.find(".final").addClass("disabled");this.$element.find(".step:not(.final)").prevAll(".step").removeClass("disabled");d.get(ea_ajaxurl,{id:this.res_app,check:ea_settings.check,
action:"ea_cancel_appointment"},function(a){a.data&&(b.$element.find(".time").find(".selected-time").removeClass("selected-time"),b.chooseStep(),b.res_app=null)},"json")},chooseStep:function(){switch(ea_settings["cancel.scroll"]){case "calendar":this.scrollToElement(this.$element.find(".date"));break;case "worker":var a=this.$element.find('[name="worker"]');a.val("");a.change();a.closest(".step").nextAll(".step").find("select").val("");this.$element.find(".time-row").remove();this.scrollToElement(a);
break;case "service":a=this.$element.find('[name="service"]');a.val("");a.change();a.closest(".step").nextAll(".step").find("select").val("");this.$element.find(".time-row").remove();this.scrollToElement(a);break;case "location":a=this.$element.find('[name="location"]'),a.val(""),a.change(),a.closest(".step").nextAll(".step").find("select").val(""),this.$element.find(".time-row").remove(),this.scrollToElement(a)}},scrollToElement:function(a){"true"!==ea_settings.scroll_off&&d("html, body").animate({scrollTop:a.offset().top-
20},500)}});d.fn.eaBootstrap=function(a){this.each(function(){d.data(this,"plugin_eaBootstrap")||d.data(this,"plugin_eaBootstrap",new k(this,a))});return this}})(jQuery,window,document);(function(d){d(".ea-bootstrap").eaBootstrap()})(jQuery);
;window.wp=window.wp||{},function(){wp.shortcode={next:function(a,b,c){var d,e,f=wp.shortcode.regexp(a);if(f.lastIndex=c||0,d=f.exec(b))return"["===d[1]&&"]"===d[7]?wp.shortcode.next(a,b,f.lastIndex):(e={index:d.index,content:d[0],shortcode:wp.shortcode.fromMatch(d)},d[1]&&(e.content=e.content.slice(1),e.index++),d[7]&&(e.content=e.content.slice(0,-1)),e)},replace:function(a,b,c){return b.replace(wp.shortcode.regexp(a),function(a,b,d,e,f,g,h,i){if("["===b&&"]"===i)return a;var j=c(wp.shortcode.fromMatch(arguments));return j?b+j+i:a})},string:function(a){return new wp.shortcode(a).string()},regexp:_.memoize(function(a){return new RegExp("\\[(\\[?)("+a+")(?![\\w-])([^\\]\\/]*(?:\\/(?!\\])[^\\]\\/]*)*?)(?:(\\/)\\]|\\](?:([^\\[]*(?:\\[(?!\\/\\2\\])[^\\[]*)*)(\\[\\/\\2\\]))?)(\\]?)","g")}),attrs:_.memoize(function(a){var b,c,d={},e=[];for(b=/([\w-]+)\s*=\s*"([^"]*)"(?:\s|$)|([\w-]+)\s*=\s*'([^']*)'(?:\s|$)|([\w-]+)\s*=\s*([^\s'"]+)(?:\s|$)|"([^"]*)"(?:\s|$)|(\S+)(?:\s|$)/g,a=a.replace(/[\u00a0\u200b]/g," ");c=b.exec(a);)c[1]?d[c[1].toLowerCase()]=c[2]:c[3]?d[c[3].toLowerCase()]=c[4]:c[5]?d[c[5].toLowerCase()]=c[6]:c[7]?e.push(c[7]):c[8]&&e.push(c[8]);return{named:d,numeric:e}}),fromMatch:function(a){var b;return b=a[4]?"self-closing":a[6]?"closed":"single",new wp.shortcode({tag:a[2],attrs:a[3],type:b,content:a[5]})}},wp.shortcode=_.extend(function(a){_.extend(this,_.pick(a||{},"tag","attrs","type","content"));var b=this.attrs;this.attrs={named:{},numeric:[]},b&&(_.isString(b)?this.attrs=wp.shortcode.attrs(b):_.isEqual(_.keys(b),["named","numeric"])?this.attrs=b:_.each(a.attrs,function(a,b){this.set(b,a)},this))},wp.shortcode),_.extend(wp.shortcode.prototype,{get:function(a){return this.attrs[_.isNumber(a)?"numeric":"named"][a]},set:function(a,b){return this.attrs[_.isNumber(a)?"numeric":"named"][a]=b,this},string:function(){var a="["+this.tag;return _.each(this.attrs.numeric,function(b){a+=/\s/.test(b)?' "'+b+'"':" "+b}),_.each(this.attrs.named,function(b,c){a+=" "+c+'="'+b+'"'}),"single"===this.type?a+"]":"self-closing"===this.type?a+" /]":(a+="]",this.content&&(a+=this.content),a+"[/"+this.tag+"]")}})}(),function(){wp.html=_.extend(wp.html||{},{attrs:function(a){var b,c;return"/"===a[a.length-1]&&(a=a.slice(0,-1)),b=wp.shortcode.attrs(a),c=b.named,_.each(b.numeric,function(a){/\s/.test(a)||(c[a]="")}),c},string:function(a){var b="<"+a.tag,c=a.content||"";return _.each(a.attrs,function(a,c){b+=" "+c,_.isBoolean(a)&&(a=a?"true":"false"),b+='="'+a+'"'}),a.single?b+" />":(b+=">",b+=_.isObject(c)?wp.html.string(c):c,b+"</"+a.tag+">")}})}();